<?xml version="1.0" encoding="utf-8"?>
<!--
/*
 * openwms.org, the Open Warehouse Management System.
 *
 * This file is part of openwms.org.
 *
 * openwms.org is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as 
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * openwms.org is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software. If not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
-->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" backgroundColor="#C2DAEF" show="init()">
    <mx:Script>
        <![CDATA[
        	import org.openwms.common.domain.system.usermanagement.User;
        	import org.openwms.common.domain.system.usermanagement.Role;
            import mx.controls.Alert;
            import mx.controls.dataGridClasses.DataGridColumn;
            import mx.collections.ArrayCollection;
            import mx.events.ListEvent;
            import org.openwms.web.flex.client.model.ModelLocator;
            import org.openwms.web.flex.client.event.RoleEvent;
            [Bindable]
            private var modelLocator:ModelLocator = ModelLocator.getInstance();
            [Bindable]
            private var selected:Role;

            private function init():void
            {
                new RoleEvent(RoleEvent.LOAD_ALL_ROLES).dispatch();
            }

            private function onRowClick(event:ListEvent):void
            {
                selected = event.currentTarget.selectedItem as Role;
                if (selected.users.length == 0) {
                	trace("The users is null");
                } 
                /*
                lastAccessTxt.text=dateFormatter.format(selected.lastAccess);
                setLocationGroup();
                setLocationType();
                */
            }

            private function showCreateLocationDialog():void
            {
            	/*
                var pop:CreateLocationDialog = CreateLocationDialog(PopUpManager.createPopUp(this, CreateLocationDialog, true));
                PopUpManager.centerPopUp(pop);
                */
            }

            private function showDeleteLocationDialog():void
            {
            	/*
                if (locationsList.selectedIndices.length == 0)
                {
                    Alert.show("Please select a Location to delete");
                    return;                 
                }
                var pop:ConfirmDeletionLocationDialog = ConfirmDeletionLocationDialog(PopUpManager.createPopUp(this, ConfirmDeletionLocationDialog, true));
                pop.messageText = "Delete selected Locations";
                pop.items = new ArrayCollection(locationsList.selectedItems);
                PopUpManager.centerPopUp(pop);
                */
            }

            private function save():void
            {
                if (lst.selectedIndices.length == 0)
                {
                    Alert.show("Please select a Role to save");
                    return;                 
                }
                var event:RoleEvent = new RoleEvent(RoleEvent.SAVE_ROLE);
                event.data = selected;
                event.dispatch();
            }

            private function refresh():void
            {
                new RoleEvent(RoleEvent.LOAD_ALL_ROLES).dispatch();
            }
            
            private function formatUser(item:*):String {
            	return (item as User).username + " - " + (item as User).fullname;
            }
        ]]>
    </mx:Script>

    <mx:HBox x="10" y="10" width="95%" verticalAlign="bottom">
	    <mx:HBox verticalAlign="middle" backgroundColor="#FFA6A6" width="100%">
	        <mx:Label x="10" y="10" text="Roles" fontSize="24"/>
	        <mx:VRule height="10"/>
	        <mx:Button id="addRoleBtn" buttonMode="true" mouseChildren="false" toolTip="Create a new Role" click="showCreateLocationDialog()"/>
	        <mx:VRule height="10"/>
	        <mx:Button id="removeRoleBtn" buttonMode="true" mouseChildren="false" toolTip="Delete an existing Role" click="showDeleteLocationDialog()"/>
	        <mx:VRule height="10"/>
	        <mx:Button id="saveRoleBtn" buttonMode="true" mouseChildren="false" toolTip="Save an existing Role" click="save()"/>
	        <mx:VRule height="10"/>
	        <mx:Button id="refreshRoleBtn" buttonMode="true" mouseChildren="false" toolTip="Refresh the list of Roles" icon="@Embed(source='assets/images/icons/refresh.png')" click="refresh()"/>
	    </mx:HBox>
    </mx:HBox>
    <mx:HRule x="9" y="53" width="95%"/>
    <mx:VBox height="100%" width="95%" x="10" y="63">
        <mx:VBox width="100%">
            <mx:DataGrid id="lst" height="200" width="100%" dataProvider="{modelLocator.allRoles}" change="onRowClick(event)">
                <mx:columns>
                    <mx:DataGridColumn headerText="Name" dataField="name" editable="false" width="100"/>
                    <mx:DataGridColumn headerText="Description" dataField="description" editable="false"/>
                </mx:columns>
            </mx:DataGrid>
            <mx:HBox width="100%">
	            <mx:VBox width="50%">
	                <mx:HBox verticalAlign="middle" backgroundColor="#FFA6A6" width="100%" backgroundAlpha="0.5" horizontalGap="8" height="25">
	                    <mx:Label x="10" y="10" text="Assigned Grants" fontSize="10"/>
	                    <mx:VRule height="10"/>
	                    <mx:Button id="assignedGrantsBtn" width="18" height="18" buttonMode="true" mouseChildren="false" toolTip="Assign Grants to the selected Role" click="showCreateLocationDialog()" icon="@Embed(source='assets/images/icons/grant--add.png')"/>
	                    <mx:VRule height="10"/>
	                    <mx:Button id="removeGrantsBtn" width="18" height="18" buttonMode="true" mouseChildren="false" toolTip="Remove Grants from the selected Role" click="showDeleteLocationDialog()" icon="@Embed(source='assets/images/icons/grant--delete.png')"/>
	                </mx:HBox>
	                <mx:List id="grantsLst" height="200" width="100%" />
	            </mx:VBox>
	            <mx:VBox width="50%">
			        <mx:HBox verticalAlign="middle" backgroundColor="#FFA6A6" width="100%" height="25" backgroundAlpha="0.5">
			            <mx:Label x="10" y="10" text="Assigned Users" fontSize="10"/>
			            <mx:VRule height="10"/>
			            <mx:Button id="assignedUsersBtn" width="18" height="18" buttonMode="true" mouseChildren="false" toolTip="Assign Users to the selected Role" click="showCreateLocationDialog()" icon="@Embed(source='/assets/icons/fuegue/user--plus.png')"/>
			            <mx:VRule height="10"/>
			            <mx:Button id="removeUsersBtn" width="18" height="18" buttonMode="true" mouseChildren="false" toolTip="Remove Users from the selected Role" click="showDeleteLocationDialog()" icon="@Embed(source='/assets/icons/fuegue/user--minus.png')"/>
			        </mx:HBox>
	                <mx:List id="usersLst" height="200" width="100%" labelFunction="formatUser" dataProvider="{selected.users}" />
	            </mx:VBox>
            </mx:HBox>
        </mx:VBox>
    </mx:VBox>
</mx:Canvas>
